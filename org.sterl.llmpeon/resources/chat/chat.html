<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<link rel="stylesheet" href="highlight.min.css">

<style>
body {
  font-family: system-ui;
  margin: 0;
  padding: 8px;
}
.message {
  margin-bottom: 12px;
}
pre {
  position: relative;
}
.copy-btn {
  position: absolute;
  top: 4px;
  right: 4px;
}
</style>

<script src="markdown-it.min.js"></script>
<script src="highlight.min.js"></script>

<script>
const md = window.markdownit({
  highlight: function (str, lang) {
    if (lang && hljs.getLanguage(lang)) {
      return hljs.highlight(str, { language: lang }).value;
    }
    return hljs.highlightAuto(str).value;
  }
});

function appendMessage(message) {
  const container = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = "message " + message.role;
  div.innerHTML = md.render(message.message ?? '');
  container.appendChild(div);
  enhanceCodeBlocks(div);
  window.scrollTo(0, document.body.scrollHeight);
}

function enhanceCodeBlocks(root) {
  root.querySelectorAll("pre").forEach(pre => {
    const btn = document.createElement("button");
    btn.textContent = "Copy";
    btn.className = "copy-btn";
    btn.onclick = () => {
      navigator.clipboard.writeText(pre.innerText);
    };
    pre.appendChild(btn);
  });
}

function clearMessages() {
  document.getElementById("chat").innerHTML = "";
}
</script>
</head>

<body>
  <div id="chat"></div>
</body>
</html>
